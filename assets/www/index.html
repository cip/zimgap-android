<!DOCTYPE HTML>

<html>

<head>

<title>PhoneGap</title>

</head>

<body>

	<!-- Button -->
	<input id="zimFileName" name="articleTitle" type="text"
		value="//sdcard/wikipedia-de.zim">
	<!-- Doesn't work (appearantly not supported by android browser)   <input id="zimFileName" name="articleTitle" type="file"
		value="//sdcard/wikipedia-de.zim">-->
	
	<input id="articleTitle" name="articleTitle" type="text" value="Graz">
	<input disabled id="list-sdcard" type="button"
		value="List SDCard Contents" />
	<input disabled id="loadarticle" type="button" value="Load article" />
	<hr>
	<div id="status"></div>
	<hr>

	<!-- Place Holder for placing the SD Card Listing -->

	<div id="result"></div>


	<script type="text/javascript" src="phonegap-1.0.0.js"></script>

	<script type="text/javascript" src="zim.js"></script>
	<script type="text/javascript">
		var startTime;
		document.addEventListener('deviceready', function() {

			var btn = document.getElementById("list-sdcard");

			btn.onclick = function() {
				btn.disabled = true;
				window.plugins.zim.list("/sdcard",

				function(r) {
					btn.disabled = false;
					printResult(r)
				},

				function(e) {
					btn.disabled = false;
					console.log(e)
				}

				);

			}

			btn.disabled = false;

			var btn = document.getElementById("loadarticle");
			btn.onclick = loadArticle;
			btn.disabled = false;

		}, true);

		function loadArticle() {
			document.getElementById("loadarticle").disabled = true;
			clearArticle();
			showStatus("Loading article "
					+ document.getElementById("articleTitle").value
					+ " from file: "
					+ document.getElementById("zimFileName").value);
			var startTime = new Date().getTime();
			window.plugins.zim.getArticleData(document
					.getElementById("zimFileName").value, document
					.getElementById("articleTitle").value, "A",

			function(r) {
				document.getElementById("loadarticle").disabled = false;
				showStatus("Article loaded. Render article...");
				var loadedTime = new Date().getTime();				
				var loadTime = loadedTime - startTime;				
				showArticle(r);
				var end = new Date().getTime();
				var renderTime = end - loadedTime;
				showStatus("Article rendered. Load time: "+loadTime+"ms\n\t Render time: "+renderTime+" ms");
				
			},

			function(e) {
				document.getElementById("loadarticle").disabled = false;
				showStatus("Error loading article");
				console.log(e)
			}

			);
		}
		
		function printResult(fileInfo) {

			var innerHtmlText = getHtml(fileInfo);

			document.getElementById("result").innerHTML = innerHtmlText;

		}

		function showStatus(status) {
			document.getElementById("status").innerHTML = status;
		}

		function clearArticle() {
			document.getElementById("result").innerHTML = "";
		}
		function showArticle(articleText) {

			document.getElementById("result").innerHTML = articleText.articletext;

		}

		function getHtml(fileInfo) {

			var htmlText = "<ul><li>" + fileInfo.filename;

			if (fileInfo.children) {

				for ( var index = 0; index < fileInfo.children.length; index++) {

					htmlText = htmlText + getHtml(fileInfo.children[index]);

				}

			}

			htmlText = htmlText + "</li></ul>";

			return htmlText;

		}
	</script>



</body>

</html>